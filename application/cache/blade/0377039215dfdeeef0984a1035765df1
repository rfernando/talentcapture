<?php $__env->startSection('page-css'); ?>
@parent

<!-- bootstrap datepicker -->
<link rel="stylesheet" href="<?php echo admin_assets_url('plugins/datepicker/datepicker3.css'); ?>">
<?php $__env->stopSection(); ?>

<div class="modal" id="sendMsg">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span></button>
                <h4 class="modal-title"><i class="fa fa-envelope"></i> Send a Message</h4>
            </div>
            <div class="modal-body">
                <form action="<?php echo base_url('messages/send'); ?>" method="post" id="chatForm" >
                    <div class="form-group">
                        <input type="hidden" name="to_user_id" value="<?php echo $candidate->agency()->first()->id; ?>">
                        <textarea name="text" placeholder="Type Message ..." class="form-control" rows="10"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" data-submit="#chatForm">Send</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>


<?php if( $candidate->client_accepted): ?>
    <div class="modal fade" tabindex="-1" role="dialog" id="hireCandidate">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span></button>
                    <h4 class="modal-title">Hire Candidate</h4>
                </div>
                <div class="modal-body">
                    <form action="<?php echo base_url('jobs/hire_candidates/'.$job->id.'/'.$candidate->id); ?>" method="post" id="requestPaymentForm">
                        <?php if(isset($candidate->hire_details) && $candidate->hire_details->count()): ?>
                          
                           <!--Resers the $candidate->hire_details object array-->
                       
							<?php
								$my_count = $candidate->hire_details->count();
								foreach($candidate->hire_details as $hire_detailt1)
								{
									$my_count--;
									$hire_details_reversed[$my_count]=$hire_detailt1;
								}
								$countn2=0;
								while($countn2<$candidate->hire_details->count())
								{
									$hire_details_reversed2[$countn2]=$hire_details_reversed[$countn2];
									$countn2++;
								}
							?>
                            <?php foreach($hire_details_reversed2 as $hire_detail): ?>
                                <h5>Candidate Reported Hired by: <?php echo $hire_detail->added_by()->first()->first_name.' '.$hire_detail->added_by()->first()->last_name; ?> on <?php echo date('F j, Y', strtotime($hire_detail->created_at)); ?></h5>
                                <dl class="pull-right">
                                    <dt><i class="fa fa-dollar"></i> Base Salary</dt>
                                    <dd><?php echo (str_replace(",","",$hire_detail->base_salary)); ?></dd>
                                </dl>
                                <dl>
                                    <dt><i class="fa fa-calendar"></i> Joining Date</dt>
                                    <dd><?php echo date('M d, Y', strtotime($hire_detail->start_date)); ?></dd>
                                </dl>
                                <dl>
                                    <dt><i class="fa fa-info-circle"></i> Additional Info</dt>
                                    <dd><?php echo $hire_detail->additional_info; ?></dd>
                                </dl>
                                <hr>
                            <?php endforeach; ?>
                            <p>Confirm the hire details by entering the same hiring details in the following fields. If the new hire information has changed or is incorrect, enter the corrected details.</p>
                        <?php endif; ?>

                        <ul>
                            <?php echo $__env->make('jobs._hired_candidates', ['hired_candidate' => $candidate], array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
                        </ul>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" data-form="#requestPaymentForm">Submit</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
<?php endif; ?>

<div class="modal fade" tabindex="-1" role="dialog" id="send_email">
    <div class="modal-dialog">
        <div class="modal-content">
            <?php echo $__env->make('dashboard_widgets._quick_email', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>


<div class="box box-primary"  id="candi_box">
    <div class="box-header with-border">
        <h3 class="box-title"><?php /*?>{{ $candidate->name }}<?php */?></h3>
        <span class="box-title"><i class="fa fa-building margin-r-5"></i>
            <a href="<?php echo base_url('agency/detail/'.$candidate->agency()->first()->id); ?>" target="_blank">Represented By: <?php echo $candidate->agency()->first()->first_name; ?> <?php echo $candidate->agency()->first()->last_name; ?> @ <?php echo $candidate->agency()->first()->user_profile()->first()->company_name; ?></a>
        </span>

        <!-- /.box-tools -->
        <div class="box-tools pull-right">
            <div class="has-feedback">
                <?php if($candidate->hired): ?>
                    <label class="label label-success" >Candidate Hired</label>
                <?php elseif($job->closed): ?>
                    <label class="label label-danger" >Candidate Not Selected</label>
                <?php elseif($candidate->client_accepted): ?>
                    <label class="label label-<?php echo ($candidate->client_accepted == 1) ? 'success' : 'danger'; ?>" >Candidate <?php echo ($candidate->client_accepted == 1) ? 'Accepted' : 'Rejected'; ?></label>
                <?php else: ?>
                    <label class="label label-warning" >Pending Approval</label>
                <?php endif; ?>
            </div>
        </div>
    </div>
    <!-- /.box-header -->
    <div class="box-body">
        <?php echo flash_msg(); ?>

        <div class="post">
            <div class="user-block">
                <img class="img-circle img-bordered-sm" src="<?php echo base_url('public/img/default_profile_pic.jpg'); ?>" alt="User Image">
                
                
                
                
                <span class="usernamenew">
                    <a href="#"><?php echo $candidate->name; ?>&nbsp;&nbsp;&nbsp;&nbsp;</a>
                    <?php if($candidate->linkedin_url != ''): ?>
                        <span>
                            <a href="<?php echo ($candidate->client_accepted == 1) ? $candidate->linkedin_url :'javascript:void(0)'; ?>" target="_blank"><i class="fa fa-linkedin-square margin-r-5 fa-lg"></i></a>
                        </span>
                    <?php endif; ?>

                    <?php if($candidate->facebook_url != ''): ?>
                        <span>
                            <a href="<?php echo ($candidate->client_accepted == 1) ? $candidate->facebook_url : 'javascript:void(0)'; ?>" target="_blank"><i class="fa fa-facebook-square margin-r-5 fa-lg"></i></a>
                        </span>
                     <?php endif; ?>
                    <span class="pull-right">
                        <?php if ( ! ($job->closed || $candidate->hired != NULL || $candidate->client_accepted < 0)): ?>

                            <?php if($candidate->client_accepted): ?>
                                <?php if ( ! ($hasHireDetails)): ?>
                                    <a href="<?php echo base_url('jobs/candidate_rsvp/'.$candidate->id.'/reject'); ?>" data-success="update_rsvp" data-toggle="tooltip" title="Decline Candidate" class="pull-right btn-box-tool ajax reject-candidate"><i class="fa fa-times fa-2x"></i></a>
                                <?php endif; ?>
                                <a href="#hireCandidate" data-toggle="modal" rel="tooltip" title="<?php echo ($hasHireDetails) ? 'Confirm Hire Details' : 'Hire Candidate'; ?>" class="pull-right btn-box-tool <?php echo ($hasHireDetails) ? 'hired-candidate ' : 'hire-candidate'; ?>"><i class="fa fa-handshake-o fa-2x" style="<?php echo ($hasHireDetails) ? 'color: #337ab7' : ''; ?>"></i></a>
                            <?php else: ?>
                                <a href="<?php echo base_url('jobs/candidate_rsvp/'.$candidate->id.'/reject'); ?>" data-success="update_rsvp" data-toggle="tooltip" title="Reject Candidate" class="pull-right btn-box-tool ajax reject-candidate"><i class="fa fa-thumbs-down fa-2x"></i></a>
                                <a href="<?php echo base_url('jobs/candidate_rsvp/'.$candidate->id.'/accept'); ?>" data-success="update_rsvp" data-toggle="tooltip" title="Accept Candidate" class="pull-right btn-box-tool ajax accept-candidate"><i class="fa fa-thumbs-up fa-2x"></i></a>
                            <?php endif; ?>
                        <?php endif; ?>
                            <?php if($candidate->hired): ?>
                            <a href="#hireCandidate" data-toggle="modal" rel="tooltip" title="Modify Hire Details" class="pull-right btn-box-tool <?php echo ($hasHireDetails) ? 'hired-candidate ' : 'hire-candidate'; ?>"><i class="fa fa-handshake-o fa-2x text-success"></i></a>
						
                            <?php endif; ?>
                            <a href="<?php echo base_url('messages/chat/'.$agencies[0]['id'].'/'.$candidate->id); ?>"  rel="tooltip" title="Send a Message to Agency" class="pull-right btn-box-tool send-message"><i class="fa fa-envelope fa-2x"></i></a>
                    </span>
                </span>

                <span class="description pull-right"><i class="fa fa-calendar margin-r-5"></i>
                    <?php echo date('d M, Y', strtotime($candidate->updated_at )); ?>

                </span>
            </div>
        </div>
        <div class="nav-tabs-custom">
            <ul class="nav nav-tabs">
                <li class="active" style="width: 18%"><a href="#info" data-toggle="tab"><i class="fa fa-info-circle fa-2x"></i> Info</a></li>
                <li style="width: 19%"><a href="#recruiter-notes" data-toggle="tab"><i class="fa fa-file fa-2x"></i> Interview Notes</a></li>
                <li style="width: 19%"><a href="#attachments" data-toggle="tab"><i class="fa fa-paperclip fa-2x"></i> Resume</a></li>
                <li style="width: 22%"><a href="#candidate-feedback" data-toggle="tab" id="discuss_click"><i class="fa fa-comments fa-2x"></i> Candidate Discussion</a></li>
                <li style="width: 19%"><a href="#activity-timeline" data-toggle="tab"><i class="fa fa fa-clock-o fa-2x"></i> Activity Timeline</a></li>
            </ul>
            <div class="tab-content">
                <div class="active tab-pane" id="info">
                    <?php if($candidate->client_accepted == 1): ?>
                        <div class="row">
                            <div class="col-md-3">
                                <strong><i class="fa fa-phone margin-r-5"></i> Phone</strong>
                                <p class="text-muted"><?php echo $candidate->phone;; ?></p>
                            </div>

                            <div class="col-md-3 ">
                                <strong><i class="fa fa-envelope margin-r-5"></i> Email</strong>
                                <p class="text-muted"><a href="#" data-toggle="modal" data-target="#send_email" data-mailto="<?php echo $candidate->email;; ?>"><?php echo $candidate->email;; ?></a></p>
                            </div>

                            <div class="col-md-3 text-center">
                                <strong><i class="fa fa-map-marker margin-r-5"></i> Location</strong>
                                <p class="text-muted"><?php echo $candidate->city;; ?><?php echo ($candidate->state()->first() != '') ? ', '.$candidate->state()->first()->abbreviation : ''; ?></p>
                            </div>

                            <div class="col-md-3 text-center">
                                <strong><i class="fa fa-map-marker margin-r-5"></i> Will Relocate</strong>
                                <p class="text-muted"><?php echo $candidate->will_relocate;; ?></p>
                            </div>

                        </div>
                        <hr>
                    <?php endif; ?>
                    <dl>
                        <dt><i class="fa fa-history margin-r-5"></i> Candidate Summary</dt>
                        <!-- <dd><?php echo $candidate->employment_history;; ?></dd>-->
                        <dd>   <iframe src="<?php echo base_url().'jobs/employmenthistory_pdf/'.$candidate->id; ?>"   width="100%" style="height:40em" > </iframe></dd>

                        <?php /*?><dt><i class="fa fa-file-text-o margin-r-5"></i> Notes</dt>
                        <dd>{{ $candidate->notes; }}</dd><?php */?>
                    </dl>
                </div>
                <!-- /.tab-pane -->
                <div class="tab-pane" id="attachments">
                    <ul class="list-group list-inline">
                        <?php if($candidate->client_accepted == 1): ?>
                            
                            <?php if($candidate->resume): ?>
                            <li class="list-group-item">
                                <a href="https://docs.google.com/viewer?url=<?php echo base_url('public/uploads/docs/'.$candidate->resume); ?>&embedded=true" target="_blank">
                                    <i class="fa fa-file-pdf-o fa-3x"></i>
                                </a><br>
                                <small class="text-info"><?php echo $candidate->resume; ?></small>
                            </li>
                            <?php endif; ?>
                            
                            <?php foreach($candidatesdocuments as $candidatesdocument): ?>
                            <li class="list-group-item">
                                <a href="https://docs.google.com/viewer?url=<?php echo base_url('public/uploads/docs/'.$candidatesdocument->title); ?>&embedded=true" target="_blank">
                                    <i class="fa fa-file-pdf-o fa-3x"></i>
                                </a><br>
                                <small class="text-info"><?php echo $candidatesdocument->title; ?></small>
                            </li>
                            <?php endforeach; ?>
                        <?php else: ?>
                            <li>Accept Candidate to view Candidate Resume</li>
                        <?php endif; ?>

					</ul>
                </div>
                <!-- /.tab-pane -->

                <div class="tab-pane" id="recruiter-notes">
                    <div class="box-footer box-comments <?php echo ($hasNotes = $candidate->notes()->count()) ? '' : 'hide'; ?>">
                        <?php if($hasNotes): ?>
                            <?php echo $__env->renderEach('partials._note', $candidate->notes()->with('added_by')->orderBy('updated_at', 'desc')->get(), 'note'); ?>
                        <?php endif; ?>
                    </div>
                    <div class="box-footer">
                        <form action="<?php echo base_url('searches/add_note/'.$candidate->id); ?>" class="ajax" data-success="add_note" method="post">
                            <?php if($userImg = get_user('profile_pic')): ?>
                                <img class="img-responsive img-circle img-sm" src="<?php echo base_url('public/uploads/'.$userImg); ?>" alt="Alt Text">
                            <?php else: ?>
                                <img class="img-responsive img-circle img-sm" src="<?php echo base_url('public/img/default_profile_pic.jpg'); ?>" alt="Alt Text">
                            <?php endif; ?>
                            <div class="img-push">
                                <textarea rows="6" name="recruiter_note" class="form-control input-sm" placeholder="Press enter to post comment" autocomplete="off"></textarea>
                                <br>
                                <input class="btn btn-primary" type="submit" value="Send">
                            </div>
                        </form>
                    </div>
                </div>

                <div class="tab-pane" id="candidate-feedback">
                    <div class="box-footer box-comments <?php echo ($hasComments = $candidate->feedback()->count()) ? '' : 'hide'; ?>">
                        <?php if($hasComments): ?>
                            <?php echo $__env->renderEach('partials._note', $candidate->feedback()->with('added_by')->orderBy('updated_at', 'desc')->get(), 'note'); ?>
                        <?php endif; ?>
                    </div>

                    <div class="box-footer">
                        <form action="<?php echo base_url('jobs/add_feedback/'.$candidate->id); ?>" class="ajax" data-success="add_note" method="post">
                            <?php if($userImg = get_user('profile_pic')): ?>
                                <img class="img-responsive img-circle img-sm" src="<?php echo base_url('public/uploads/'.$userImg); ?>" alt="Alt Text">
                            <?php else: ?>
                                <img class="img-responsive img-circle img-sm" src="<?php echo base_url('public/img/default_profile_pic.jpg'); ?>" alt="Alt Text">
                            <?php endif; ?>
                            <div class="img-push">
                                <input type="hidden" name="job_provider"  id="job_provider" value="<?=$candidate->agency()->first()->id;?>">
                                <textarea onKeyUp="discussion_submit_validate()" rows="6" name="employer_feedback" id="employer_feedback" class="form-control input-sm" placeholder="Press send to post comment" autocomplete="off"></textarea><br>
                                <input id="discussion_submit" disabled class="btn btn-primary" type="submit" value="Send">
                            </div>
                        </form>
                    </div>
                </div>
                
                
                 <div class="tab-pane" id="activity-timeline">
                    <table width="100%">
					<tr><td><br></td><td></td></tr>
                    	<?php if($candidate->client_accepted == 1): ?>
							<tr>
								<td valign="top" width="180">Candidate Accepted</td><td><i><?php echo $candidate->client_accepted_at; ?></i></td>
							</tr>
							<tr><td><hr align="right" width="95%" color="#565656" /></td><td><hr align="left" width="15%" color="#565656" /></td></tr>
							
						<?php /*?>@else
							<tr>
								<td valign="top" width="180">Candidate Acceptance</td><td><i>Pending</i></td>
							</tr><?php */?>
						<?php endif; ?>
							
						<?php if($candidate->client_accepted == -1): ?>
							<tr>
								<td valign="top" width="180">Candidate Rejected</td><td><i><?php echo substr($candidate->updated_at,0,10);?></i></td>
							</tr>
							<tr><td><hr align="right" width="95%" color="#565656" /></td><td><hr align="left" width="15%" color="#565656" /></td></tr>
                  		<?php endif; ?>	
       
									
									<?php if ($candidate->hired == 1)
									{
										?>
										<tr>
										<td valign="top" width="180">Candidate Reported Hired</td><td><i>
										<?php
										echo substr(Hire_details::where('type','=','Hire')->find($candidate->id)->created_at,0,10);
									?>
									</i></td></tr>
									<tr><td><hr align="right" width="95%" color="#565656" /></td><td><hr align="left" width="15%" color="#565656" /></td></tr>
									<?php
									}
									else
									{
										//echo("Pending");
									}
									?>

									
									<?php
									if (Hire_details::where('type','=','Hire')->where('candidate_id','=',$candidate->id)->count() > 0)
									{
										?>
										<tr>
										<td valign="top" width="180">Hire Details Edited by</td><td><i>
										<?php
										$name1 = User::find(Hire_details::where('type','=','Hire')->find($candidate->id)->added_by);
										echo($name1->first_name." ".$name1->last_name);
										?>
									</i></td></tr>
									<tr><td><hr align="right" width="95%" color="#565656" /></td><td><hr align="left" width="15%" color="#565656" /></td></tr>
									<?php
									}
									else
									{
										//echo("-");
									}
									?>
									
								
									<?php 
									if(Hire_details::where('type','=','Request Payment')->where('candidate_id','=',$candidate->id)->count() > 0)
									{
										?>
										<tr>
										<td valign="top" width="180">New Hire Details Edited by</td><td><i>
										<?php
										$myRsltSet =Hire_details::where('candidate_id','=',$candidate->id)->where('type','=','Request Payment')->orderBy('id', 'desc')->get(); 
										foreach($myRsltSet AS $myRow)
										{
											$name2 = User::find($myRow->added_by);
											echo($name2->first_name." ".$name2->last_name." - on ".substr($myRow->updated_at,0,10).".<br>");
										}
										?>
									</i></td></tr>
									<tr><td><hr align="right" width="95%" color="#565656" /></td><td><hr align="left" width="15%" color="#565656" /></td></tr>
									<?php
									}
									else
									{
										//echo("-");
									}
									?>

									<?php 
									if (Recruiter_notes::where('candidate_id','=',$candidate->id)->count() > 0)
									{
										?>
										<tr>
										<td valign="top" width="180">Interview Notes Provided</td><td><i>
										<?php
										$myRsltSet =Recruiter_notes::where('candidate_id','=',$candidate->id)->orderBy('id', 'desc')->get(); 
										foreach($myRsltSet AS $myRow)
										{
												echo substr($myRow['created_at'],0,10).".<br>";
										}
										?>
									</i></td></tr>
									<tr><td><hr align="right" width="95%" color="#565656" /></td><td><hr align="left" width="15%" color="#565656" /></td></tr>
									<?php
									}
									else
									{
										//echo("-");
									}
									?>
					 </table>
                </div>
                
                
                <!-- /.tab-pane -->
            </div>
            <!-- /.tab-content -->
        </div>
    </div>
</div>

<?php $__env->startSection('page-js'); ?>
@parent

<!-- Datepicker -->
<script src="<?php echo admin_assets_url('plugins/datepicker/bootstrap-datepicker.js'); ?>"></script>
<?php $__env->stopSection(); ?>



<?php $__env->startSection('end-script'); ?>
    @parent

    <script type="application/javascript">
		
		//enable send button for Candidate Discussion
		
		function discussion_submit_validate()
		{
			var comment_text = document.getElementById("employer_feedback").value.trim();
			if (comment_text.length>0)
				{
					document.getElementById("discussion_submit").disabled=false;
				}
			else
				{
					document.getElementById("discussion_submit").disabled=true;
				}
		}
		
		//trigger tab click on Candidate Discussion
		
		function discussion_click()
		{
			$('#discuss_click').click();
		}
		
        function update_rsvp(result, element) {
            element.parent().html(result.msg);
            window.location.reload();
        }


        $('.datepicker').datepicker({
            autoclose: true,
            format: 'yyyy-mm-dd'
        });

        function add_note(result, element) {
            var commentContainer = element.parent().prev();
            if(commentContainer.hasClass('hide')){
                commentContainer.removeClass('hide')
            }
            commentContainer.prepend(result.msg);

        }

        document.getElementById("label-resume").style.paddingRight = "0px";
        document.getElementById("resume").style.width = "50%";
        
    </script>

    <!--- Start Display Active and Inactive Jobs's List--->
    <?php if($job->closed): ?>
        <script>
            $('#active').hide();
        </script>
    <?php else: ?>
        <script>
            $('#closed').hide();
        </script>
    <?php endif; ?>
    <!--- End Display Active and Inactive Jobs's List--->

<?php $__env->stopSection(); ?>
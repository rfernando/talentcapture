

<?php $__env->startSection('title','Users list'); ?><?php $__env->stopSection(); ?>

<?php $__env->startSection('page-css'); ?>
        <!-- jvectormap -->
<link rel="stylesheet" href="<?php echo admin_assets_url('plugins/datatables/dataTables.bootstrap.css'); ?>">
<link rel="stylesheet" href="<?php echo admin_assets_url('plugins/iCheck/square/blue.css'); ?>">
<link rel="stylesheet" href="<?php echo admin_assets_url('plugins/datepicker/datepicker3.css'); ?>">
<?php $__env->stopSection(); ?>







<?php $__env->startSection('main-content'); ?>
        <!-- Content Header (Page header) -->
<section class="content-header">
    <h1>
        Placements
        <small>Placement Details of Agencies</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="<?php echo admin_url('dashboard'); ?>"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active"><i class="fa fa-users"></i> Placements</li>
    </ol>
</section>
<script>
function tlnt_load(val)
	{
		if (val=="new000")
			{
				//var job_type_val = document.getElementById('job_type').value;
				window.location.href="<?php echo admin_url('placements'); ?>";
			}
		else
			{
				window.location.href="<?php echo admin_url('placements/load_talentg/"+val+"'); ?>";
			}
	}
	
function tlntg_dtls_load(val)
	{
		val2 = document.getElementById('agency_usr_lst').value;
		if (val=="new000")
			{
				window.location.href="<?php echo admin_url('placements/load_talentg/"+val2+"'); ?>";
			}
		else
			{
				window.location.href="<?php echo admin_url('placements/load_talentg_dtls/"+val+"/"+val2+"'); ?>";
			}
	}

function tlntg_dtls_load_after_cancel()
	{
		val = document.getElementById('agency_tlntg_lst').value;
		/*val2 = document.getElementById('agency_usr_lst').value;

		if (val=="new000")
			{
				window.location.href="<?php echo admin_url('placements/load_talentg/"+val2+"'); ?>";
			}
		else
			{
				window.location.href="<?php echo admin_url('placements/load_talentg_dtls/"+val+"/"+val2+"'); ?>";
			}*/
			return "91";
	}
	
</script>
<!-- Main content -->
<section class="content">
    <div class="row">
        <div class="col-xs-5">
            <div class="box box-primary">
                <div class="box-header">
                    <h3 class="box-title">Agency</h3> 
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    <?php if(count($agencies)>0): ?>
						<select id="agency_usr_lst" onChange="tlnt_load(this.value)"  name="agency_usr_lst" style="width: 95%">
							<option value="new000">Select an Agency</option>
							<?php foreach($agencies as $agency): ?>
								<option value="<?php echo $agency->id; ?>"><?php echo $agency->agencyName; ?></option>
							<?php endforeach; ?>
						</select><br><br>
                        <?php endif; ?>
                        
                        <?php if(isset($agency_usr)): ?>
                        <script>
								document.getElementById('agency_usr_lst').value=<?php echo $agency_usr; ?>;
						</script>
                        <?php endif; ?>
                </div>
                <?php if(isset($agency_tlntg_info)): ?>
                <div class="box-header">
                    <h3 class="box-title">TalentGram</h3> 
                </div>
                <div class="box-body">
                	
					<select id="agency_tlntg_lst" onChange="tlntg_dtls_load(this.value)"  name="agency_tlntg_lst" style="width: 95%">
						<option value="new000">Select a TalentGram</option>
						<?php foreach($agency_tlntg_info as $agency_tlntg_row): ?>
							<option value="<?php echo $agency_tlntg_row->id; ?>"><?php echo $agency_tlntg_row->title; ?></option>
						<?php endforeach; ?>
					</select><br><br>
					
                </div>
                <?php endif; ?>


					<?php if(isset($agency_tlntg)): ?>
					<script>
							document.getElementById('agency_tlntg_lst').value=<?php echo $agency_tlntg; ?>;
					</script>
					<?php endif; ?>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->
        </div>
        <?php if(isset($agency_tlntg_dtls_info) && count($agency_tlntg_dtls_info)>0): ?>
        <div class="col-xs-12">
            <div class="box box-primary">
                <div class="box-header">
                    <h3 class="box-title">Placement Details <a href="<?php echo admin_url('jobs/edit/'.$agency_tlntg_dtls_info[0]->jobId); ?>"><i class="fa fa-briefcase" title="Edit TalentGram" data-toggle="tooltip"></i></a></h3>
                    <div class="box-tools pull-right">
                        <?php /*?><span data-original-title="{{ get_awaiting_approval('job') }} New Jobs" data-toggle="tooltip"
                              title="" class="badge bg-light-blue">{{ get_awaiting_approval('job') }} New Jobs</span>
                        <button type="button" class="btn btn-box-tool" data-toggle="tooltip" id="delete"
                                title="Delete Selected"><i class="fa fa-trash"></i></button><?php */?>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body">
                    
                    
						<?php $i = 0;?>
                       <table width="100%">
									  <tr>
										  <th>Candidate</th>
										  <th>Start Date &nbsp; &nbsp;</th>
										  <th>Guarantee End Date</th>
										  <th>Salary</th>
										  <th>Placement Fee</th>
										  <th><center>Action</center></th>
									  </tr>
									  <?php foreach($agency_tlntg_dtls_info as $agency_tlntg_dtls_row): ?>
									  <tr style="<?php echo ($agency_tlntg_dtls_row->hire_cancelled == 1) ? 'color: red;text-decoration: line-through;' : 'color: black'; ?>">
										  <td valign="top"><?php echo $agency_tlntg_dtls_row->name; ?></td>
										  <td valign="top"><?php echo $agency_tlntg_dtls_row->start_date; ?></td>
										  <td valign="top"><?php echo date('Y-m-d',strtotime("+".(int)$agency_tlntg_dtls_row->warranty_period." days", strtotime($agency_tlntg_dtls_row->start_date))); ?></td>
										  <td valign="top"><?php echo "$ ".(str_replace(",","",$agency_tlntg_dtls_row->base_salary)); ?></td>
										  <td valign="top"><?php
											  if($agency_tlntg_dtls_row->type=="agency")
											  {
												  echo "$ ".((float)(str_replace(",","",$agency_tlntg_dtls_row->base_salary)))*((float)$agency_tlntg_dtls_row->placement_fee/100.00)*((float)$agency_tlntg_dtls_row->split_percentage/100.00);
											  }
											  else
											  {
												  echo "$ ".(((((float)(str_replace(",","",$agency_tlntg_dtls_row->base_salary)))/100.00)*(float)$agency_tlntg_dtls_row->placement_fee)/100.00)*80.00;
											  }
											  ?>										  

											  </td>
										  <th>
										  
										  
										  <?php
											  $job = Job::find($agency_tlntg_dtls_info[0]->jobId);
											  $candidate = Candidate::with('hire_details')->find($agency_tlntg_dtls_row->id);
											   $hasHireDetails = $candidate->hire_details()->where(['type'=>'Request Payment'])->count();
											  ?>
										  
	<div class="modal fade" tabindex="-1" role="dialog" id="hireCandidate<?php echo $i;?>">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span></button>
                    <h4 class="modal-title">Hire Candidate</h4>
                </div>
                <div class="modal-body">
                    <form action="<?php echo admin_url('jobs/hire_candidates/'.$agency_tlntg_dtls_info[0]->jobId.'/'.$candidate->id.'/'.$agency_usr); ?>" method="post" id="requestPaymentForm">
                        <?php if(isset($candidate->hire_details) && $candidate->hire_details->count()): ?>
                            <?php foreach($candidate->hire_details as $hire_detail): ?>
                                <h5>Candidate Reported Hired by: <?php echo $hire_detail->added_by()->first()->first_name.' '.$hire_detail->added_by()->first()->last_name; ?></h5>
                                <dl class="pull-right">
                                    <dt><i class="fa fa-dollar"></i> Base Salary</dt>
                                    <dd><?php echo $hire_detail->base_salary; ?></dd>
                                </dl>
                                <dl>
                                    <dt><i class="fa fa-calendar"></i> Start Date</dt>
                                    <dd><?php echo date('M d, Y', strtotime($hire_detail->start_date)); ?></dd>
                                </dl>
                                <?php if($hire_detail->additional_info != ''): ?>
	                                <dl>
	                                    <dt><i class="fa fa-info-circle"></i> Additional Info</dt>
	                                    <dd><?php echo $hire_detail->additional_info; ?></dd>
	                                </dl>
	                            <?php endif; ?>
                                <hr>
                            <?php endforeach; ?>
                        <?php endif; ?>

                        <ul>
                            <?php echo $__env->make('jobs._hired_candidates', ['hired_candidate' => $candidate], array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>
                        </ul>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" data-form="#requestPaymentForm">Submit</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    	</div>
    		<?php if($agency_tlntg_dtls_row->hire_cancelled == 0): ?>

    		<center>
    				<a href="#hireCandidate<?php echo $i;?>" data-toggle="modal" rel="tooltip" title="Modify Hire Details." class=" <?php echo ($hasHireDetails) ? 'hired-candidate ' : 'hire-candidate'; ?>"><i class="fa fa-dollar"></i></a>
					
					<?php   
					    $CI =& get_instance();
					    $CI->load->helper('url');
					    $uid=$CI->uri->segment(5);
					?>


					<a href="<?php echo admin_url('placements/cancel_reported_hire/'.$agency_tlntg_dtls_row->hire_id.'/'.$agency_tlntg_dtls_row->id.'/'.$agency_tlntg_dtls_row->jobId.'/'.$uid); ?>" data-toggle="tooltip" title="Cancel Reported Hires" onclick="return confirm('Are you sure you want to cancel this reported hire?')"><i class="fa fa-trash" style="color:red"></i></a>
			
			</center>
			<?php endif; ?>
		</th>
									  </tr>
									  <?php $i++; ?>
									  <?php endforeach; ?> 
								  </table>
                    
                        
                </div>
                <!-- /.box-body -->
            </div>
            <!-- /.box -->
        </div>
        <?php endif; ?>
        <!-- /.col -->
    </div>
    <!-- /.row -->
</section>
<!-- /.content -->
<?php $__env->stopSection(); ?>

<?php $__env->startSection('page-js'); ?>
        <!-- DataTables -->
<script src="<?php echo admin_assets_url('plugins/datatables/jquery.dataTables.min.js'); ?>"></script>
<script src="<?php echo admin_assets_url('plugins/datatables/dataTables.bootstrap.min.js'); ?>"></script>
<script src="<?php echo admin_assets_url('plugins/iCheck/icheck.min.js'); ?>"></script>
<script src="<?php echo admin_assets_url('plugins/datepicker/bootstrap-datepicker.js'); ?>"></script>

<script>
	$('.datepicker').datepicker({
            autoclose: true,
            format: 'yyyy-mm-dd'
        });
</script>
<?php $__env->stopSection(); ?>

<?php echo $__env->make('admin.template._main', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>